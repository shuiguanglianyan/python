<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Lightweight CMDB</title>
    <link rel="stylesheet" href="/static/style.css" />
  </head>
  <body>
    <header>
      <h1>Lightweight CMDB</h1>
      <p>轻量级 DevOps 运维资产与变更管理系统</p>
    </header>

    <main>
      <section class="card">
        <h2>搜索资产</h2>
        <form method="get" action="/" class="grid grid-3">
          <input type="text" name="q" value="{{ q }}" placeholder="按主机/IP/负责人搜索" />
          <select name="status">
            <option value="" {% if not status %}selected{% endif %}>全部状态</option>
            <option value="active" {% if status == 'active' %}selected{% endif %}>active</option>
            <option value="inactive" {% if status == 'inactive' %}selected{% endif %}>inactive</option>
          </select>
          <button type="submit">查询</button>
        </form>
      </section>

      <section class="card">
        <h2>新增资产</h2>
        <form method="post" action="/assets" class="grid grid-4">
          <input required name="hostname" placeholder="hostname" />
          <input required name="ip" placeholder="ip" />
          <input name="environment" value="prod" placeholder="environment" />
          <input name="os" value="linux" placeholder="os" />
          <input name="owner" placeholder="owner" />
          <input name="status" value="active" placeholder="status" />
          <input class="span-2" name="note" placeholder="note" />
          <button type="submit">添加资产</button>
        </form>
      </section>

      <section class="card">
        <h2>新增服务</h2>
        <form method="post" action="/services" class="grid grid-4">
          <input required name="name" placeholder="service name" />
          <input required name="asset_id" type="number" placeholder="asset id" />
          <input name="repo_url" placeholder="repo url" />
          <input name="deploy_method" value="ansible" placeholder="deploy method" />
          <input name="owner" placeholder="owner" />
          <input name="status" value="running" placeholder="status" />
          <input class="span-2" name="note" placeholder="note" />
          <button type="submit">添加服务</button>
        </form>
      </section>

      <section class="card">
        <h2>新增变更</h2>
        <form method="post" action="/changes" class="grid grid-4">
          <input required name="title" placeholder="change title" />
          <input required type="number" name="service_id" placeholder="service id" />
          <input name="risk_level" value="medium" placeholder="risk level" />
          <input name="change_window" placeholder="window" />
          <input name="executor" placeholder="executor" />
          <input name="approver" placeholder="approver" />
          <input name="status" value="pending" placeholder="status" />
          <input name="rollback_plan" placeholder="rollback plan" />
          <button type="submit">添加变更</button>
        </form>
      </section>

      <section class="card">
        <h2>资产列表</h2>
        <table>
          <thead>
            <tr><th>ID</th><th>Hostname</th><th>IP</th><th>Env</th><th>Owner</th><th>Status</th><th>操作</th></tr>
          </thead>
          <tbody>
            {% for a in assets %}
            <tr>
              <td>{{ a.id }}</td><td>{{ a.hostname }}</td><td>{{ a.ip }}</td><td>{{ a.environment }}</td><td>{{ a.owner }}</td><td>{{ a.status }}</td>
              <td>
                <form method="post" action="/assets/{{ a.id }}/delete">
                  <button class="danger">删除</button>
                </form>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </section>

      <section class="card">
        <h2>服务列表</h2>
        <table>
          <thead>
            <tr><th>ID</th><th>Name</th><th>AssetID</th><th>Deploy</th><th>Owner</th><th>Status</th><th>操作</th></tr>
          </thead>
          <tbody>
            {% for s in services %}
            <tr>
              <td>{{ s.id }}</td><td>{{ s.name }}</td><td>{{ s.asset_id }}</td><td>{{ s.deploy_method }}</td><td>{{ s.owner }}</td><td>{{ s.status }}</td>
              <td>
                <form method="post" action="/services/{{ s.id }}/delete">
                  <button class="danger">删除</button>
                </form>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </section>

      <section class="card">
        <h2>变更列表</h2>
        <table>
          <thead>
            <tr><th>ID</th><th>Title</th><th>ServiceID</th><th>Risk</th><th>Executor</th><th>Status</th><th>操作</th></tr>
          </thead>
          <tbody>
            {% for c in changes %}
            <tr>
              <td>{{ c.id }}</td><td>{{ c.title }}</td><td>{{ c.service_id }}</td><td>{{ c.risk_level }}</td><td>{{ c.executor }}</td><td>{{ c.status }}</td>
              <td>
                <form method="post" action="/changes/{{ c.id }}/delete">
                  <button class="danger">删除</button>
                </form>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </section>
    </main>
  </body>
</html>
